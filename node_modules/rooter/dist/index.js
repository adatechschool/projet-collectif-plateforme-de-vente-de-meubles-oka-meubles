"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter=_interopDefault(require("events")),util=_interopDefault(require("util")),PUSH="PUSH",POP="POP",REPLACE="REPLACE",RESET="RESET",UPDATE="UPDATE",ON_PUSH="ONPUSH",ON_POP="ONPOP",ON_REPLACE="ONREPLACE",ON_RESET="ONRESET",ON_UPDATE="ONUPDATE",emitter=new EventEmitter,addCallback=function(e,t){"function"==typeof t&&emitter.addListener(e,t)},onPush=function(e){addCallback(ON_PUSH,e)},onPop=function(e){addCallback(ON_POP,e)},onReplace=function(e){addCallback(ON_REPLACE,e)},onReset=function(e){addCallback(ON_RESET,e)},onUpdate=function(e){addCallback(ON_UPDATE,e)};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var strictUriEncode=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),token="%[a-f0-9]{2}",singleMatcher=RegExp(token,"gi"),multiMatcher=RegExp("("+token+")+","gi");function decodeComponents(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;var r=e.slice(0,t=t||1),n=e.slice(t);return Array.prototype.concat.call([],decodeComponents(r),decodeComponents(n))}function decode(e){try{return decodeURIComponent(e)}catch(n){for(var t=e.match(singleMatcher),r=1;t.length>r;r++)t=(e=decodeComponents(t,r).join("")).match(singleMatcher);return e}}function customDecodeURIComponent(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=multiMatcher.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=decode(r[0]);n!==r[0]&&(t[r[0]]=n)}r=multiMatcher.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),a=0;o.length>a;a++){var i=o[a];e=e.replace(RegExp(i,"g"),t[i])}return e}var decodeUriComponent=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return customDecodeURIComponent(e)}},splitOnFirst=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]};function encoderForArrayFormat(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const o=r.length;return void 0===n||e.skipNull&&null===n?r:null===n?[...r,encode(t,e)+"["+o+"]"]:[...r,encode(t,e)+"["+encode(o,e)+"]="+encode(n,e)]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n?r:null===n?[...r,encode(t,e)+"[]"]:[...r,encode(t,e)+"[]="+encode(n,e)];case"comma":return t=>(r,n)=>null==n||0===n.length?r:0===r.length?[encode(t,e)+"="+encode(n,e)]:[[r,encode(n,e)].join(",")];default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n?r:null===n?[...r,encode(t,e)]:[...r,encode(t,e)+"="+encode(n,e)]}}function parserForArrayFormat(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),n[e]=t?void 0!==n[e]?[].concat(n[e],r):[r]:r};case"comma":return(e,t,r)=>{const n="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;r[e]=n};default:return(e,t,r)=>{r[e]=void 0!==r[e]?[].concat(r[e],t):t}}}function encode(e,t){return t.encode?t.strict?strictUriEncode(e):encodeURIComponent(e):e}function decode$1(e,t){return t.decode?decodeUriComponent(e):e}function keysSorter(e){return Array.isArray(e)?e.sort():"object"==typeof e?keysSorter(Object.keys(e)).sort((e,t)=>Number(e)-Number(t)).map(t=>e[t]):e}function removeHash(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function extract(e){const t=(e=removeHash(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function parseValue(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function parse(e,t){const r=parserForArrayFormat(t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",parseNumbers:!1,parseBooleans:!1},t)),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const o of e.split("&")){let[e,a]=splitOnFirst(t.decode?o.replace(/\+/g," "):o,"=");a=void 0===a?null:decode$1(a,t),r(decode$1(e,t),a,n)}for(const e of Object.keys(n)){const r=n[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=parseValue(r[e],t);else n[e]=parseValue(r,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((e,t)=>{const r=n[t];return e[t]=r&&"object"==typeof r&&!Array.isArray(r)?keysSorter(r):r,e},Object.create(null))}var extract_1=extract,parse_1=parse,stringify=(e,t)=>{if(!e)return"";const r=encoderForArrayFormat(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),n=Object.assign({},e);if(t.skipNull)for(const e of Object.keys(n))null==n[e]&&delete n[e];const o=Object.keys(n);return!1!==t.sort&&o.sort(t.sort),o.map(n=>{const o=e[n];return void 0===o?"":null===o?encode(n,t):Array.isArray(o)?o.reduce(r(n),[]).join("&"):encode(n,t)+"="+encode(o,t)}).filter(e=>e.length>0).join("&")},parseUrl=(e,t)=>({url:removeHash(e).split("?")[0]||"",query:parse(extract(e),t)}),queryString={extract:extract_1,parse:parse_1,stringify:stringify,parseUrl:parseUrl},isarray=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},pathToRegexp_1=pathToRegexp,parse_1$1=parse$1,compile_1=compile,tokensToFunction_1=tokensToFunction,tokensToRegExp_1=tokensToRegExp,PATH_REGEXP=/(\\.)|([\/.])?(?:(?:\:(\w+)(?:\(((?:\\.|[^\\()])+)\))?|\(((?:\\.|[^\\()])+)\))([+*?])?|(\*))/g;function parse$1(e,t){for(var r,n=[],o=0,a=0,i="",s=t&&t.delimiter||"/";null!=(r=PATH_REGEXP.exec(e));){var c=r[0],u=r[1],l=r.index;if(i+=e.slice(a,l),a=l+c.length,u)i+=u[1];else{var p=e[a],d=r[2],f=r[3],h=r[4],v=r[5],g=r[6],y=r[7];i&&(n.push(i),i="");var m=r[2]||s,E=h||v;n.push({name:f||o++,prefix:d||"",delimiter:m,optional:"?"===g||"*"===g,repeat:"+"===g||"*"===g,partial:null!=d&&null!=p&&p!==d,asterisk:!!y,pattern:E?escapeGroup(E):y?".*":"[^"+escapeString(m)+"]+?"})}}return e.length>a&&(i+=e.substr(a)),i&&n.push(i),n}function compile(e,t){return tokensToFunction(parse$1(e,t),t)}function encodeURIComponentPretty(e){return encodeURI(e).replace(/[\/?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function encodeAsterisk(e){return encodeURI(e).replace(/[?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function tokensToFunction(e,t){for(var r=Array(e.length),n=0;e.length>n;n++)"object"==typeof e[n]&&(r[n]=RegExp("^(?:"+e[n].pattern+")$",flags(t)));return function(t,n){for(var o="",a=t||{},i=(n||{}).pretty?encodeURIComponentPretty:encodeURIComponent,s=0;e.length>s;s++){var c=e[s];if("string"!=typeof c){var u,l=a[c.name];if(null==l){if(c.optional){c.partial&&(o+=c.prefix);continue}throw new TypeError('Expected "'+c.name+'" to be defined')}if(isarray(l)){if(!c.repeat)throw new TypeError('Expected "'+c.name+'" to not repeat, but received `'+JSON.stringify(l)+"`");if(0===l.length){if(c.optional)continue;throw new TypeError('Expected "'+c.name+'" to not be empty')}for(var p=0;l.length>p;p++){if(u=i(l[p]),!r[s].test(u))throw new TypeError('Expected all "'+c.name+'" to match "'+c.pattern+'", but received `'+JSON.stringify(u)+"`");o+=(0===p?c.prefix:c.delimiter)+u}}else{if(u=c.asterisk?encodeAsterisk(l):i(l),!r[s].test(u))throw new TypeError('Expected "'+c.name+'" to match "'+c.pattern+'", but received "'+u+'"');o+=c.prefix+u}}else o+=c}return o}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function escapeGroup(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function attachKeys(e,t){return e.keys=t,e}function flags(e){return e&&e.sensitive?"":"i"}function regexpToRegexp(e,t){var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;r.length>n;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(e,t)}function arrayToRegexp(e,t,r){for(var n=[],o=0;e.length>o;o++)n.push(pathToRegexp(e[o],t,r).source);return attachKeys(RegExp("(?:"+n.join("|")+")",flags(r)),t)}function stringToRegexp(e,t,r){return tokensToRegExp(parse$1(e,r),t,r)}function tokensToRegExp(e,t,r){isarray(t)||(r=t||r,t=[]);for(var n=(r=r||{}).strict,o=!1!==r.end,a="",i=0;e.length>i;i++){var s=e[i];if("string"==typeof s)a+=escapeString(s);else{var c=escapeString(s.prefix),u="(?:"+s.pattern+")";t.push(s),s.repeat&&(u+="(?:"+c+u+")*"),a+=u=s.optional?s.partial?c+"("+u+")?":"(?:"+c+"("+u+"))?":c+"("+u+")"}}var l=escapeString(r.delimiter||"/"),p=a.slice(-l.length)===l;return n||(a=(p?a.slice(0,-l.length):a)+"(?:"+l+"(?=$))?"),attachKeys(RegExp("^"+(a+=o?"$":n&&p?"":"(?="+l+"|$)"),flags(r)),t)}function pathToRegexp(e,t,r){return isarray(t)||(r=t||r,t=[]),r=r||{},e instanceof RegExp?regexpToRegexp(e,t):isarray(e)?arrayToRegexp(e,t,r):stringToRegexp(e,t,r)}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}function getCjsExportFromNamespace(e){return e&&e.default||e}pathToRegexp_1.parse=parse_1$1,pathToRegexp_1.compile=compile_1,pathToRegexp_1.tokensToFunction=tokensToFunction_1,pathToRegexp_1.tokensToRegExp=tokensToRegExp_1;var codes={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"(Unused)",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},codes$1=Object.freeze({__proto__:null,default:codes}),codes$2=getCjsExportFromNamespace(codes$1),statuses=status;function populateStatusesMap(e,t){var r=[];return Object.keys(t).forEach((function(n){var o=t[n],a=Number(n);e[a]=o,e[o]=a,e[o.toLowerCase()]=a,r.push(a)})),r}function status(e){if("number"==typeof e){if(!status[e])throw Error("invalid status code: "+e);return e}if("string"!=typeof e)throw new TypeError("code must be a number or string");var t=parseInt(e,10);if(!isNaN(t)){if(!status[t])throw Error("invalid status code: "+t);return t}if(!(t=status[e.toLowerCase()]))throw Error('invalid status message: "'+e+'"');return t}status.STATUS_CODES=codes$2,status.codes=populateStatusesMap(status,codes$2),status.redirect={300:!0,301:!0,302:!0,303:!0,305:!0,307:!0,308:!0},status.empty={204:!0,205:!0,304:!0},status.retry={502:!0,503:!0,504:!0};var inherits=util.inherits,httpErrors=createCommonjsModule((function(e,t){var r=(t=e.exports=function e(){for(var r,n,o=500,a={},i=0;arguments.length>i;i++){var s=arguments[i];if(s instanceof Error)o=(r=s).status||r.statusCode||o;else switch(typeof s){case"string":n=s;break;case"number":o=s;break;case"object":a=s}}"number"==typeof o&&statuses[o]||(o=500);var c=t[o];for(var u in r||(r=c?new c(n):Error(n||statuses[o]),Error.captureStackTrace(r,e)),c&&r instanceof c||(r.expose=500>o,r.status=r.statusCode=o),a)"status"!==u&&"statusCode"!==u&&(r[u]=a[u]);return r}).HttpError=function(){throw new TypeError("cannot construct abstract class")};inherits(r,Error),statuses.codes.filter((function(e){return e>=400})).forEach((function(e){var n=statuses[e].split(" ").map((function(e){return e.slice(0,1).toUpperCase()+e.slice(1)})).join("").replace(/[^ _0-9a-z]/gi,""),o=n.match(/Error$/)?n:n+"Error";if(e>=500){var a=function t(r){var n=Error(null!=r?r:statuses[e]);return Error.captureStackTrace(n,t),n.__proto__=t.prototype,Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:o,writable:!0}),n};return inherits(a,r),a.prototype.status=a.prototype.statusCode=e,a.prototype.expose=!1,void(t[e]=t[n]=a)}var i=function t(r){var n=Error(null!=r?r:statuses[e]);return Error.captureStackTrace(n,t),n.__proto__=t.prototype,Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:o,writable:!0}),n};inherits(i,r),i.prototype.status=i.prototype.statusCode=e,i.prototype.expose=!0,t[e]=t[n]=i})),t["I'mateapot"]=t.ImATeapot})),httpErrors_1=httpErrors.HttpError,pathMatch=function(e){return e=e||{},function(t){var r=[],n=pathToRegexp_1(t,r,e);return function(e,t){var o,a,i=n.exec(e);if(!i)return!1;t=t||{};for(var s=0;r.length>s;s++)o=r[s],(a=i[s+1])&&(t[o.name]=decodeParam(a),o.repeat&&(t[o.name]=t[o.name].split(o.delimiter)));return t}}};function decodeParam(e){try{return decodeURIComponent(e)}catch(t){throw httpErrors(400,'failed to decode param "'+e+'"')}}var matcher=pathMatch({sensitive:!1,strict:!1,end:!0});function setId(){return Math.random().toString(36).substr(2,5)}function setParams(e,t){return t(e)||{}}function Route(e){var t=e.pathname,r=e.state,n=void 0===r?{}:r,o=setId(),a=t.split("#"),i=a[1]||null,s=queryString.parseUrl(a[0]),c=s.query,u=s.url,l=e.pattern||null;return{id:o,hash:i,location:t,pathname:u,pattern:l,params:setParams(u,matcher(l||"")),query:c,state:n,created:Date.now(),updated:null,setPattern:function(e){this.pattern=e,this.params=setParams(this.pathname,matcher(this.pattern))||{}}}}var EPARAMSMISSING="Missing params when routing",EPARAMSEMPTY="Empty params when routing",EPARAMSINVALID="The given params are invalid",EMISSINGPATTERN="Missing pattern when registering a route",EMISSINGPATHNAME="Missing pathname",EINVALIDPATTERN="Invalid type for pattern when registering a route",EINVALIDPATHNAME="No matching pattern was found for the given pathname",EINVALIDSTEPS="The number of steps you have given is invalid",EINVALIDID="The given id does not point to any route";function _extends$1(){return(_extends$1=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var w=function(e){return e};function x(e){e.preventDefault(),e.returnValue=""}function y(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function z(){return Math.random().toString(36).substr(2,8)}function B(e){var t=e.pathname,r=e.search;return(void 0===t?"/":t)+(void 0===r?"":r)+(void 0===(e=e.hash)?"":e)}function C(e){var t={};if(e){var r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r)),(r=e.indexOf("?"))>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var createBrowserHistory=function(e){function t(){var e=a.location,t=i.state||{};return[t.idx,w({pathname:e.pathname,search:e.search,hash:e.hash,state:t.usr||null,key:t.key||"default"})]}function r(e,t){return void 0===t&&(t=null),w(_extends$1({},l,{},"string"==typeof e?C(e):e,{state:t,key:z()}))}function n(e){c=e,e=t(),u=e[0],d.call({action:c,location:l=e[1]})}function o(e){i.go(e)}var a=void 0===(e=(void 0===e?{}:e).window)?document.defaultView:e,i=a.history,s=null;a.addEventListener("popstate",(function(){if(s)p.call(s),s=null;else{var e=t(),r=e[0];if(e=e[1],p.length)if(null!=r){var a=u-r;a&&(s={action:"POP",location:e,retry:function(){o(-1*a)}},o(a))}else n("POP")}}));var c="POP",u=(e=t())[0],l=e[1],p=y(),d=y();null==u&&i.replaceState(_extends$1({},i.state,{idx:u=0}),null);var f=B;return{get action(){return c},get location(){return l},createHref:f,push:function e(t,o){var s=r(t,o);if(!p.length||(p.call({action:"PUSH",location:s,retry:function(){e(t,o)}}),0)){var c=[{usr:s.state,key:s.key,idx:u+1},f(s)];s=c[0],c=c[1];try{i.pushState(s,null,c)}catch(e){a.location.assign(c)}n("PUSH")}},replace:function e(t,o){var a=r(t,o);p.length&&(p.call({action:"REPLACE",location:a,retry:function(){e(t,o)}}),1)||(a=[{usr:a.state,key:a.key,idx:u},f(a)],i.replaceState(a[0],null,a[1]),n("REPLACE"))},go:o,back:function(){o(-1)},forward:function(){o(1)},listen:function(e){return d.push(e)},block:function(e){var t=p.push(e);return 1===p.length&&a.addEventListener("beforeunload",x),function(){t(),p.length||a.removeEventListener("beforeunload",x)}}}},stack=new Map;function add(e,t){e&&t&&stack.set(e,t)}function first(){return stack.size?stack.entries().next().value:null}function get(e){return e&&stack.has(e)?stack.get(e):null}function getByIndex(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?null:e>stack.size-1?null:stack.get(Array.from(stack.keys())[e])}function getAll(){return this.stack}function last(){return stack.size?Array.from(stack.entries()).pop():null}function clear(){stack.clear()}function remove(e){stack.delete(e)}function update(e,t){e&&t&&stack.has(e)&&stack.set(e,t)}var stack$1={add:add,clear:clear,first:first,get:get,getAll:getAll,getByIndex:getByIndex,last:last,remove:remove,stack:stack,update:update},Router=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:createBrowserHistory;_classCallCheck(this,e),this.handleNativeEvent=function(e){var r=e.location,n=e.action;if(t.nativeEvent){var o=stack$1.getByIndex(t.routeIndex+1);o&&r.state&&r.state.route&&o.id===r.state.route.id?t.handlePush({pathname:r.pathname,state:r.state},!1,!0):n===POP&&t.handlePop()}},this.addInitialRoute=function(){var e=t.history.location,r=e.hash,n=e.search,o=new Route({pathname:"".concat(e.pathname).concat(n).concat(r)});stack$1.add(o.id,o)},this.handlePop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(r,n){var o=e.emit,a=void 0===o||o,i=e.forceNative,s=void 0!==i&&i,c=e.steps,u=void 0===c?1:c,l=e.state,p=void 0===l?null:l,d=null;if(0>=u)return n(Error(EINVALIDSTEPS)),void(t.nativeEvent=!0);var f=Math.max(t.routeIndex-u,0),h=stack$1.getByIndex(t.routeIndex),v=stack$1.getByIndex(f),g={prev:h,next:v};p&&(v.state=Object.assign(v.state,p));var y=function(){d(),t.routeIndex=f,t.action=POP,a&&emitter.emit(ON_POP,g),r(g),t.nativeEvent=!0};d=t.history.listen(y),s||!t.nativeEvent?t.history.go(-1*u):y()}))},this.findPattern=function(e){return Object.keys(t.patterns).find((function(r){return t.patterns[r].match(e)}))||null},this.register=function(e){if(!e)throw Error(EMISSINGPATTERN);if("string"!=typeof e)throw Error(EINVALIDPATTERN);var r=matcher(e);t.patterns[e]={match:r};var n=_slicedToArray(stack$1.first(),2)[1];null===n.pattern&&(r(n.pathname)&&(n.setPattern(e),emitter.emit(ON_PUSH,{prev:null,next:n},!0)))},this.deregister=function(e){delete t.patterns[e]},this.handleReplace=function(e){return new Promise((function(r,n){if(!e)return n(Error(EPARAMSMISSING)),void(t.nativeEvent=!0);if(0===Object.keys(e).length)return n(Error(EPARAMSEMPTY)),void(t.nativeEvent=!0);var o=e.emit,a=void 0===o||o,i=e.pathname,s=e.state,c=t.findPattern(i.split("?")[0]),u=null;if(!c)return n(Error(EINVALIDPATHNAME)),void(t.nativeEvent=!0);var l=stack$1.getByIndex(t.routeIndex).id,p=stack$1.get(l),d=new Route({pathname:i,pattern:c,state:s}),f={prev:p,next:d};stack$1.add(l,d);var h=function(){u(),t.action=REPLACE,a&&emitter.emit(ON_REPLACE,f),r(f),t.nativeEvent=!0};u=t.history.listen(h),t.nativeEvent?h():t.history.replace({pathname:i,state:_extends({},s,{route:{id:l}})})}))},this.push=function(e){return t.nativeEvent=!1,t.handlePush(e)},this.pop=function(e){return t.nativeEvent=!1,t.handlePop(e)},this.replace=function(e){return t.nativeEvent=!1,t.handleReplace(e)},this.reset=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise((function(r,n){var o=_slicedToArray(stack$1.first(),2)[1],a={prev:stack$1.getByIndex(t.routeIndex),next:o};0!==t.routeIndex?(e&&t.update(o.id,e,!1),t.handlePop({emit:!1,forceNative:!0,steps:t.routeIndex}).then((function(){emitter.emit(ON_RESET,a),r(a)}))):n()}))},this.resetTo=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,o){if(e)if(t.findPattern(e))if(0!==t.routeIndex){var a=t.getCurrentRoute();t.handlePop({emit:!1,forceNative:!0,steps:t.routeIndex}).then((function(){t.handleReplace({pathname:e,state:r}).then((function(){var e=_slicedToArray(stack$1.first(),2),t={prev:a,next:e[1]};emitter.emit(ON_RESET,t),n(t)}))}))}else o();else o(Error(EINVALIDPATHNAME));else o(Error(EMISSINGPATHNAME))}))},this.update=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=2>=arguments.length||void 0===arguments[2]||arguments[2];return new Promise((function(n,o){if(e&&0!==Object.keys(t).length){var a=stack$1.get(e);a?(a.state=Object.assign(a.state,t),a.updated=Date.now(),stack$1.update(e,a),r&&emitter.emit(ON_UPDATE,a),n(a)):o(Error(EINVALIDID))}else o(Error(EPARAMSINVALID))}))},this.getCurrentRoute=function(){return stack$1.getByIndex(t.routeIndex)},this.match=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=!1;return!!e&&(Object.entries(t.patterns).some((function(t){var n=_slicedToArray(t,2),o=n[0];return!!n[1].match(e)&&(r=o,!0)})),r)},this.nativeEvent=!0,this.history=r(),this.patterns={},this.routeIndex=0,this.action=PUSH,"function"==typeof this.historyListener&&(this.historyListener(),stack$1.clear()),this.addInitialRoute(),this.historyListener=this.history.listen(this.handleNativeEvent)}return _createClass(e,[{key:"handlePush",value:function(e){var t=this,r=1>=arguments.length||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(o,a){if(!e)return a(Error(EPARAMSMISSING)),void(t.nativeEvent=!0);if(0===Object.keys(e).length)return a(Error(EPARAMSEMPTY)),void(t.nativeEvent=!0);var i=e.emit,s=void 0===i||i,c=e.pathname,u=e.state,l=t.findPattern(c.split("?")[0]),p=null;if(r)for(;t.routeIndex<stack$1.getAll().size-1;){var d=_slicedToArray(stack$1.last(),1);stack$1.remove(d[0])}var f=stack$1.getByIndex(t.routeIndex),h=n?stack$1.getByIndex(t.routeIndex+1):new Route({pathname:c,pattern:l,state:u});n||stack$1.add(h.id,h);var v=function(){p(),t.routeIndex+=1,t.action=PUSH,s&&emitter.emit(ON_PUSH,{prev:f,next:h}),o({prev:f,next:h}),t.nativeEvent=!0};p=t.history.listen(v),t.nativeEvent?v():t.history.push({pathname:c,state:_extends({},u,{route:{id:h.id}})})}))}}]),e}(),index=new Router;exports.ON_POP=ON_POP,exports.ON_PUSH=ON_PUSH,exports.ON_REPLACE=ON_REPLACE,exports.ON_RESET=ON_RESET,exports.ON_UPDATE=ON_UPDATE,exports.POP=POP,exports.PUSH=PUSH,exports.REPLACE=REPLACE,exports.RESET=RESET,exports.UPDATE=UPDATE,exports.addCallback=addCallback,exports.onPop=onPop,exports.onPush=onPush,exports.onReplace=onReplace,exports.onReset=onReset,exports.onUpdate=onUpdate,exports.router=index;
